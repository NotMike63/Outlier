<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPS Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            background-color: #f4f4f9;
        }
        .sidebar {
            width: 60px;
            background-color: #1a1a1a;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
        }
        .sidebar div {
            margin: 20px 0;
            text-align: center;
        }
        .main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .header h1 {
            margin: 0;
        }
        .sign-in-button {
            background-color: #6a5acd;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-decoration: none;
        }
        .sign-in-button:hover {
            background-color: #5a4abd;
        }
        .tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .tabs div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .tabs div.active {
            border-bottom: 2px solid #6a5acd;
            color: #6a5acd;
        }
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .filters select {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .charts {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            flex: 1;
            text-align: center;
        }
        .customization {
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .customization label {
            display: block;
            margin: 10px 0 5px;
        }
        .customization input, .customization select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .metrics-tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .metrics-tabs div {
            padding: 10px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .metrics-tabs div.active {
            border-bottom: 2px solid #6a5acd;
            color: #6a5acd;
        }
        canvas {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div>u</div>
        <div>üìä</div>
        <div>üë•</div>
        <div>üì¶</div>
        <div>üìà</div>
        <div>üìã</div>
        <div>‚öôÔ∏è</div>
    </div>
    <div class="main">
        <div class="header">
            <h1>NPS</h1>
            <a href="signin.html" class="sign-in-button">Sign In</a>
        </div>
        <div class="tabs">
            <div class="active" onclick="showTab('overview')">Overview</div>
            <div onclick="showTab('responses')">Responses</div>
        </div>
        <div id="overview" class="tab-content">
            <div class="filters">
                <select>
                    <option>ALL segments</option>
                </select>
                <select>
                    <option>ALL companies</option>
                </select>
                <select>
                    <option>Last 7 days</option>
                </select>
            </div>
            <div class="charts">
                <div class="chart-container">
                    <h3>SCORE</h3>
                    <canvas id="scoreGauge"></canvas>
                </div>
                <div class="chart-container">
                    <h3>RESPONSES</h3>
                    <canvas id="responsesDonut"></canvas>
                    <div>
                        <p>Promoters: 612 (80%)</p>
                        <p>Passives: 101 (10%)</p>
                        <p>Detractors: 101 (10%)</p>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <h3>NPS HISTORY</h3>
                <canvas id="npsHistory"></canvas>
            </div>
        </div>
        <div id="responses" class="tab-content" style="display: none;">
            <div class="customization">
                <h3>Data</h3>
                <input type="file" id="fileInput" accept=".csv">
                <h3>Customize Chart</h3>
                <label for="xAxisLabel">X-Axis Label</label>
                <input type="text" id="xAxisLabel" value="Time">
                <label for="yAxisLabel">Y-Axis Label</label>
                <input type="text" id="yAxisLabel" value="Score">
                <label for="promoterColor">Promoter Color</label>
                <input type="color" id="promoterColor" value="#28a745">
                <label for="passiveColor">Passive Color</label>
                <input type="color" id="passiveColor" value="#6c757d">
                <label for="detractorColor">Detractor Color</label>
                <input type="color" id="detractorColor" value="#dc3545">
            </div>
        </div>
        <div class="chart-container">
            <div class="metrics-tabs">
                <div class="active">Data Metrics</div>
            </div>
            <p>Mean: <span id="mean"></span></p>
            <p>Median: <span id="median"></span></p>
            <p>Mode: <span id="mode"></span></p>
            <p>Standard Deviation: <span id="stdDev"></span></p>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctxScoreGauge = document.getElementById('scoreGauge').getContext('2d');
        const ctxResponsesDonut = document.getElementById('responsesDonut').getContext('2d');
        const ctxNpsHistory = document.getElementById('npsHistory').getContext('2d');

        let promoterColor = '#28a745';
        let passiveColor = '#6c757d';
        let detractorColor = '#dc3545';
        let xAxisLabel = 'Time';
        let yAxisLabel = 'Score';

        const scoreGauge = new Chart(ctxScoreGauge, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [53, 47],
                    backgroundColor: ['#6a5acd', '#e9ecef'],
                    borderWidth: 0
                }]
            },
            options: {
                cutout: '80%',
                rotation: -90,
                circumference: 180,
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                }
            }
        });

        const responsesDonut = new Chart(ctxResponsesDonut, {
            type: 'doughnut',
            data: {
                labels: ['Promoters', 'Passives', 'Detractors'],
                datasets: [{
                    data: [80, 10, 10],
                    backgroundColor: [promoterColor, passiveColor, detractorColor],
                    borderWidth: 1
                }]
            },
            options: {
                plugins: {
                    legend: { display: false }
                }
            }
        });

        const npsHistory = new Chart(ctxNpsHistory, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                datasets: [
                    {
                        label: 'Promoters',
                        data: [80, 75, 70, 65, 60, 55, 50],
                        backgroundColor: promoterColor,
                        stack: 'Stack 0'
                    },
                    {
                        label: 'Passives',
                        data: [10, 15, 20, 25, 30, 35, 40],
                        backgroundColor: passiveColor,
                        stack: 'Stack 0'
                    },
                    {
                        label: 'Detractors',
                        data: [10, 10, 10, 10, 10, 10, 10],
                        backgroundColor: detractorColor,
                        stack: 'Stack 0'
                    },
                    {
                        label: 'Score',
                        type: 'line',
                        data: [50, 60, 40, 30, 20, 30, 40],
                        borderColor: '#000',
                        borderWidth: 2,
                        fill: false
                    }
                ]
            },
            options: {
                scales: {
                    x: { title: { display: true, text: xAxisLabel } },
                    y: { title: { display: true, text: yAxisLabel } }
                }
            }
        });

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const text = event.target.result;
                const data = parseCSV(text);
                updateCharts(data);
                updateMetrics(data);
            };
            reader.readAsText(file);
        });

        document.getElementById('xAxisLabel').addEventListener('input', function(e) {
            xAxisLabel = e.target.value;
            npsHistory.options.scales.x.title.text = xAxisLabel;
            npsHistory.update();
        });

        document.getElementById('yAxisLabel').addEventListener('input', function(e) {
            yAxisLabel = e.target.value;
            npsHistory.options.scales.y.title.text = yAxisLabel;
            npsHistory.update();
        });

        document.getElementById('promoterColor').addEventListener('input', function(e) {
            promoterColor = e.target.value;
            responsesDonut.data.datasets[0].backgroundColor[0] = promoterColor;
            npsHistory.data.datasets[0].backgroundColor = promoterColor;
            responsesDonut.update();
            npsHistory.update();
        });

        document.getElementById('passiveColor').addEventListener('input', function(e) {
            passiveColor = e.target.value;
            responsesDonut.data.datasets[0].backgroundColor[1] = passiveColor;
            npsHistory.data.datasets[1].backgroundColor = passiveColor;
            responsesDonut.update();
            npsHistory.update();
        });

        document.getElementById('detractorColor').addEventListener('input', function(e) {
            detractorColor = e.target.value;
            responsesDonut.data.datasets[0].backgroundColor[2] = detractorColor;
            npsHistory.data.datasets[2].backgroundColor = detractorColor;
            responsesDonut.update();
            npsHistory.update();
        });

        function parseCSV(text) {
            const rows = text.split('\n').map(row => row.split(','));
            const headers = rows[0];
            const data = rows.slice(1).map(row => {
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = row[index];
                });
                return obj;
            });
            return data;
        }

        function updateCharts(data) {
            const scores = data.map(d => parseFloat(d.score));
            const promoters = data.filter(d => parseFloat(d.score) >= 9).length;
            const passives = data.filter(d => parseFloat(d.score) >= 7 && parseFloat(d.score) < 9).length;
            const detractors = data.filter(d => parseFloat(d.score) < 7).length;
            const total = promoters + passives + detractors;
            const promoterPercent = (promoters / total * 100).toFixed(2);
            const passivePercent = (passives / total * 100).toFixed(2);
            const detractorPercent = (detractors / total * 100).toFixed(2);

            responsesDonut.data.datasets[0].data = [promoterPercent, passivePercent, detractorPercent];
            responsesDonut.update();

            const npsScore = ((promoters - detractors) / total * 100).toFixed(2);
            scoreGauge.data.datasets[0].data = [npsScore, 100 - npsScore];
            scoreGauge.update();

            const historyData = data.reduce((acc, curr) => {
                const date = curr.date;
                if (!acc[date]) acc[date] = { promoters: 0, passives: 0, detractors: 0, total: 0 };
                if (parseFloat(curr.score) >= 9) acc[date].promoters++;
                else if (parseFloat(curr.score) >= 7) acc[date].passives++;
                else acc[date].detractors++;
                acc[date].total++;
                return acc;
            }, {});

            const labels = Object.keys(historyData);
            const promoterData = labels.map(date => (historyData[date].promoters / historyData[date].total * 100).toFixed(2));
            const passiveData = labels.map(date => (historyData[date].passives / historyData[date].total * 100).toFixed(2));
            const detractorData = labels.map(date => (historyData[date].detractors / historyData[date].total * 100).toFixed(2));
            const scoreData = labels.map(date => ((historyData[date].promoters - historyData[date].detractors) / historyData[date].total * 100).toFixed(2));

            npsHistory.data.labels = labels;
            npsHistory.data.datasets[0].data = promoterData;
            npsHistory.data.datasets[1].data = passiveData;
            npsHistory.data.datasets[2].data = detractorData;
            npsHistory.data.datasets[3].data = scoreData;
            npsHistory.update();
        }

        function updateMetrics(data) {
            const scores = data.map(d => parseFloat(d.score)).filter(s => !isNaN(s));
            const mean = scores.reduce((a, b) => a + b, 0) / scores.length;
            const sortedScores = scores.sort((a, b) => a - b);
            const median = sortedScores.length % 2 === 0 ? (sortedScores[sortedScores.length / 2 - 1] + sortedScores[sortedScores.length / 2]) / 2 : sortedScores[Math.floor(sortedScores.length / 2)];
            const modeObj = scores.reduce((acc, curr) => {
                acc[curr] = (acc[curr] || 0) + 1;
                return acc;
            }, {});
            const mode = Object.keys(modeObj).reduce((a, b) => modeObj[a] > modeObj[b] ? a : b);
            const stdDev = Math.sqrt(scores.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / scores.length);

            document.getElementById('mean').textContent = mean.toFixed(2);
            document.getElementById('median').textContent = median.toFixed(2);
            document.getElementById('mode').textContent = mode;
            document.getElementById('stdDev').textContent = stdDev.toFixed(2);
        }

        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
            document.querySelectorAll('.tabs div').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tab).style.display = 'block';
            document.querySelector(`.tabs div[onclick="showTab('${tab}')"]`).classList.add('active');
        }
    </script>
</body>
</html>